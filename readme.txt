onlineすごろくを作・・・っています。

共通
functions.php
データベース接続とセッション確認。
sqlデータ
今回は頭にsugorokuとついている４つのデータベースを使用しています。
うちimagesについてはほぼ扱っていません。(一応データが入ったことを確認した段階)

分類
①ログインまで
②sugoroku_admins類
③ゲームデータ作成、ロードなど。
④ゲーム起動時以降の処理

①ログインまで
sugoroku_startpage.php ->　はじめに開く想定のファイル。
新規登録→情報を記入したら -> sugoroku_register_act.php
ログイン→情報を記入したら -> sugoroku_login_act.php
どちらも出口は, sugoroku_userspage.phpです。
それで重要なのが、隠しコマンドで"Q" + "U" + "N" を同時押しするとログインの仕方が出てきます。管理者としてログインをチェックすると -> sugoroku_adminsフォルダ内のsugoroku_admin.phpに飛びます。
※is_admin == 1 のアカウントのみ。今回はQunQuuun qwertyasdfgh。

②sugoroku_admins類
$_POSTで"readdata"が返ってきている場合はselectでデータベースを取得し該当のデータ一覧を列挙します。
ラジオボタンにチェックを入れて検索すると同ファイルに$_POSTを返します。
sugoroku_delete.phpは選択物をそのまま即消去。
sugoroku_insert.phpはトップの"コンテンツを追加"ボタンを押した場合に現れるフォームの内容を入力するとデータベースにINSERTします。
→画像データの出力ができていません。画像一覧は選んでも文字化けの文字列が現れるだけです。

③ゲームデータ作成、ロードなど。
sugoroku_userpage.php以降。

新しいゲームデータを作成 -> sugoroku_gamecreate_act.phpへ。
全体のマス数が特殊マス+2(スタートとゴール)より多いとuserpageに返します。
それ以外の場合、sugoroku_gamesテーブルへのデータの作成と、sugoroku_cellsテーブルへのマスデータを生成して、sugoroku_game.phpへ出します。その際に、各種の変数をセッション→game.php→jsへと移動します。

ゲームデータをロード -> sugoroku_gameload_act.phpへ。
表示は自分がplayer1~4のいずれかに入っているgame_idのデータを列挙する想定です。
選択したラジオボタンのものをPOSTして、本当に存在しているかの確認のみ行い、sugoroku.game.phpへ出します。変数移動も同様に。

ゲームに参加する -> game_IDを入力するとそのゲームを検索し、既に自分が参加済みのものをロード、またはplayer2~4のいずれかがcpuのものに自分を代入しデータをアップロードして、sugoroku_game.phpに出します。変数移動も同様ですが、"guest"として参加することになります。

④ゲーム起動以降。
オンライン同期を行うためにfirebaseとの連携を試みているのですが、処理順序の沼にはまっています。
またセッション状態を維持したまま、他のアカウントで(guestとして)入って確認する動きは果たして可能なのか？となっています。(現状その前の段階で壁に当たっているので未確認)
できているところとしては、firebaseへのデータ書き込みとアップデートは単体では機能して、複合したときの矛盾がほぐせず。
またこのメンバーで始めるを押した際に、sugoroku_shuffle.phpが起動し、プレイヤーをランダムに並びかえて、その情報をMysqlにアップデートする動作も"単体としては"機能しました。

一度処理順序が解決すれば、diceを振ることでnowCell(現在マス)をfirebaseにアップデートし、同期させるなどできる想定ですが、上記のように複数アカウントで同時に確認する作業に不安が残っている状態です。

一応今回の企画としてのphpで行いたい部分の処理は完了した状態(複合部分についてはまだな箇所もありますが)ですが、プロダクトとしては動かせないレベルでの提出となります。


